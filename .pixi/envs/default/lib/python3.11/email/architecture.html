
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>email Package Architecture &#8212; DestinE DataLake Lab</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '.pixi/envs/default/lib/python3.11/email/architecture';</script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../../README.html">
  
  
  
  
  
  
    <p class="title logo__title">DestinE DataLake Lab</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../../../README.html">
                    DestinE-DataLake-Lab
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">STACK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../STACK/README.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../STACK/gallery.html">STACK - Gallery</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../STACK/DEDL_StackService_Dask.html">DestinE Data Lake - Stack Service Dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../STACK/STACK-Python-Client-Dask.html">STACK service - Python Client Dask</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../../../../STACK/ExtremeDT-DataCube-xViewer.html">Create a dashboard based on Data Cube populated with data obtained from Weather and Geophysical Extremes Digital Twin (DT) - ExtremeDT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../STACK/ExtremeDT-DataCube.html">Data Cube populated with data obtained from Weather and Geophysical Extremes Digital Twin (DT) - ExtremeDT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../STACK/STACK-Dask-101.html">STACK service - Dask 101</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HDA</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../HDA/README.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../HDA/gallery.html">HDA - Gallery</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/EODAG/HDA-EODAG-quick-start.html">DEDL - EODAG - A quick start with DEDL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/EODAG/HDA-EODAG-full-version.html">DEDL - EODAG - DestinE Data Lake Provider (DEDL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/ClimateDT-ParameterPlotter.html">DEDL - HDA Climate DT Parameter Plotter - Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/ExtremeDT-ParameterPlotter.html">DEDL - HDA Extreme DT Parameter Plotter - Tutorial</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE-Series.html">Destination Earth - Climate Change Adaptation Digital Twin Series Plot- Data Access using DEDL HDA</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_CLIMATE.html">Destination Earth - Climate Change Adaptation Digital Twin - Data Access using DEDL HDA</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES.html">Destination Earth - Weather-Induced Extremes Digital Twin - Data Access using DEDL HDA</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/DestinE%20Digital%20Twins/DEDL-HDA-EO.ECMWF.DAT.DT_EXTREMES-Series.html">Destination Earth - Weather-Induced Extremes Digital Twin - Data Access using DEDL HDA</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/EUM_data/DEDL-HDA-EO.EUM.DAT.SENTINEL-3.OL_1_ERR___.html">Destination Earth - OLCI Level 1B Reduced Resolution - Sentinel-3 - Data Access using DEDL HDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/EUM_data/DEDL-HDA-EO.EUM.DAT.METOP.AVHRRL1.html">Destination Earth - AVHRR Level 1B Metop Global - Data Access using DEDL HDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/Fresh%20Data%20Pool/DEDL-HDA-EO.ESA.DAT.SENTINEL-1.L1_GRD.html">Example of Using HDA to Find and Download Data for Urban Area Monitoring Using Sentinel-1 Data</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/Fresh%20Data%20Pool/DEDL-HDA-EO.ESA.DAT.SENTINEL-2.MSI.L2A.html">Example of how to use HDA to find and download data for conducting monitoring of Śniadrwy lake</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/REST/HDA-REST-Queryables.html">DEDL - HDA Tutorial - Queryables</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/REST/HDA-REST-full-version.html">DEDL - HDA Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/REST/HDA-REST-quick-start.html">DEDL - HDA Tutorial - quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/CDS_data/DEDL-HDA-EO.ECMWF.DAT.REANALYSIS_ERA5_SINGLE_LEVELS.html">Destination Earth - ERA5 hourly data on single levels from 1940 to present - Data Access using DEDL HDA</a></li>




<li class="toctree-l2"><a class="reference internal" href="../../../../../../HDA/PySTAC/HDA-PyStac-Client.html">HDA PySTAC-Client Introduction</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HOOK</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../HOOK/README.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../HOOK/gallery.html">HOOK - Gallery</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HOOK/Tutorial.html">DEDL - Hook Tutorial - Data Harvest (data-harvest)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../HOOK/DEDL-Hook_access.html">Access to Hook services</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../../../_sources/.pixi/envs/default/lib/python3.11/email/architecture.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>email Package Architecture</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model">The Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#message-lifecycle">Message Lifecycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#header-policy-control-during-lifecycle">Header Policy Control During Lifecycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-binary-data">Handling Binary Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-compatibility">Backward Compatibility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-algorithm">New Algorithm</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="email-package-architecture">
<h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code> Package Architecture<a class="headerlink" href="#email-package-architecture" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>The email package consists of three major components:</p>
<blockquote>
<div><dl class="simple">
<dt>Model</dt><dd><p>An object structure that represents an email message, and provides an
API for creating, querying, and modifying a message.</p>
</dd>
<dt>Parser</dt><dd><p>Takes a sequence of characters or bytes and produces a model of the
email message represented by those characters or bytes.</p>
</dd>
<dt>Generator</dt><dd><p>Takes a model and turns it into a sequence of characters or bytes.  The
sequence can either be intended for human consumption (a printable
unicode string) or bytes suitable for transmission over the wire.  In
the latter case all data is properly encoded using the content transfer
encodings specified by the relevant RFCs.</p>
</dd>
</dl>
</div></blockquote>
<p>Conceptually the package is organized around the model.  The model provides both
“external” APIs intended for use by application programs using the library,
and “internal” APIs intended for use by the Parser and Generator components.
This division is intentionally a bit fuzzy; the API described by this
documentation is all a public, stable API.  This allows for an application
with special needs to implement its own parser and/or generator.</p>
<p>In addition to the three major functional components, there is a third key
component to the architecture:</p>
<blockquote>
<div><dl class="simple">
<dt>Policy</dt><dd><p>An object that specifies various behavioral settings and carries
implementations of various behavior-controlling methods.</p>
</dd>
</dl>
</div></blockquote>
<p>The Policy framework provides a simple and convenient way to control the
behavior of the library, making it possible for the library to be used in a
very flexible fashion while leveraging the common code required to parse,
represent, and generate message-like objects.  For example, in addition to the
default <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc5322.html"><strong>RFC 5322</strong></a> email message policy, we also have a policy that manages
HTTP headers in a fashion compliant with <span class="target" id="index-1"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a>.  Individual policy
controls, such as the maximum line length produced by the generator, can also
be controlled individually to meet specialized application requirements.</p>
</section>
<section id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Link to this heading">#</a></h2>
<p>The message model is implemented by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code> class.
The model divides a message into the two fundamental parts discussed by the
RFC: the header section and the body.  The <cite>Message</cite> object acts as a
pseudo-dictionary of named headers.  Its dictionary interface provides
convenient access to individual headers by name.  However, all headers are kept
internally in an ordered list, so that the information about the order of the
headers in the original message is preserved.</p>
<p>The <cite>Message</cite> object also has a <cite>payload</cite> that holds the body.  A <cite>payload</cite> can
be one of two things: data, or a list of <cite>Message</cite> objects.  The latter is used
to represent a multipart MIME message.  Lists can be nested arbitrarily deeply
in order to represent the message, with all terminal leaves having non-list
data payloads.</p>
</section>
<section id="message-lifecycle">
<h2>Message Lifecycle<a class="headerlink" href="#message-lifecycle" title="Link to this heading">#</a></h2>
<p>The general lifecycle of a message is:</p>
<blockquote>
<div><dl class="simple">
<dt>Creation</dt><dd><p>A <cite>Message</cite> object can be created by a Parser, or it can be
instantiated as an empty message by an application.</p>
</dd>
<dt>Manipulation</dt><dd><p>The application may examine one or more headers, and/or the
payload, and it may modify one or more headers and/or
the payload.  This may be done on the top level <cite>Message</cite>
object, or on any sub-object.</p>
</dd>
<dt>Finalization</dt><dd><p>The Model is converted into a unicode or binary stream,
or the model is discarded.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="header-policy-control-during-lifecycle">
<h2>Header Policy Control During Lifecycle<a class="headerlink" href="#header-policy-control-during-lifecycle" title="Link to this heading">#</a></h2>
<p>One of the major controls exerted by the Policy is the management of headers
during the <cite>Message</cite> lifecycle.  Most applications don’t need to be aware of
this.</p>
<p>A header enters the model in one of two ways: via a Parser, or by being set to
a specific value by an application program after the Model already exists.
Similarly, a header exits the model in one of two ways: by being serialized by
a Generator, or by being retrieved from a Model by an application program.  The
Policy object provides hooks for all four of these pathways.</p>
<p>The model storage for headers is a list of (name, value) tuples.</p>
<p>The Parser identifies headers during parsing, and passes them to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">header_source_parse()</span></code> method of the Policy.  The
result of that method is the (name, value) tuple to be stored in the model.</p>
<p>When an application program supplies a header value (for example, through the
<cite>Message</cite> object <cite>__setitem__</cite> interface), the name and the value are passed to
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">header_store_parse()</span></code> method of the Policy, which
returns the (name, value) tuple to be stored in the model.</p>
<p>When an application program retrieves a header (through any of the dict or list
interfaces of <cite>Message</cite>), the name and value are passed to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">header_fetch_parse()</span></code> method of the Policy to
obtain the value returned to the application.</p>
<p>When a Generator requests a header during serialization, the name and value are
passed to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">fold()</span></code> method of the Policy, which
returns a string containing line breaks in the appropriate places.  The
<code class="xref py py-meth docutils literal notranslate"><span class="pre">cte_type()</span></code> Policy control determines whether or
not Content Transfer Encoding is performed on the data in the header.  There is
also a <code class="xref py py-meth docutils literal notranslate"><span class="pre">binary_fold()</span></code> method for use by generators
that produce binary output, which returns the folded header as binary data,
possibly folded at different places than the corresponding string would be.</p>
</section>
<section id="handling-binary-data">
<h2>Handling Binary Data<a class="headerlink" href="#handling-binary-data" title="Link to this heading">#</a></h2>
<p>In an ideal world all message data would conform to the RFCs, meaning that the
parser could decode the message into the idealized unicode message that the
sender originally wrote.  In the real world, the email package must also be
able to deal with badly formatted messages, including messages containing
non-ASCII characters that either have no indicated character set or are not
valid characters in the indicated character set.</p>
<p>Since email messages are <em>primarily</em> text data, and operations on message data
are primarily text operations (except for binary payloads of course), the model
stores all text data as unicode strings.  Un-decodable binary inside text
data is handled by using the <cite>surrogateescape</cite> error handler of the ASCII
codec.  As with the binary filenames the error handler was introduced to
handle, this allows the email package to “carry” the binary data received
during parsing along until the output stage, at which time it is regenerated
in its original form.</p>
<p>This carried binary data is almost entirely an implementation detail.  The one
place where it is visible in the API is in the “internal” API.  A Parser must
do the <cite>surrogateescape</cite> encoding of binary input data, and pass that data to
the appropriate Policy method.  The “internal” interface used by the Generator
to access header values preserves the <cite>surrogateescaped</cite> bytes.  All other
interfaces convert the binary data either back into bytes or into a safe form
(losing information in some cases).</p>
</section>
<section id="backward-compatibility">
<h2>Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Link to this heading">#</a></h2>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Compat32</span></code> Policy provides backward
compatibility with version 5.1 of the email package.  It does this via the
following implementation of the four+1 Policy methods described above:</p>
<dl class="simple">
<dt>header_source_parse</dt><dd><p>Splits the first line on the colon to obtain the name, discards any spaces
after the colon, and joins the remainder of the line with all of the
remaining lines, preserving the linesep characters to obtain the value.
Trailing carriage return and/or linefeed characters are stripped from the
resulting value string.</p>
</dd>
<dt>header_store_parse</dt><dd><p>Returns the name and value exactly as received from the application.</p>
</dd>
<dt>header_fetch_parse</dt><dd><p>If the value contains any <cite>surrogateescaped</cite> binary data, return the value
as a <code class="xref py py-class docutils literal notranslate"><span class="pre">Header</span></code> object, using the character set
<cite>unknown-8bit</cite>.  Otherwise just returns the value.</p>
</dd>
<dt>fold</dt><dd><p>Uses <code class="xref py py-class docutils literal notranslate"><span class="pre">Header</span></code>’s folding to fold headers in the
same way the email5.1 generator did.</p>
</dd>
<dt>binary_fold</dt><dd><p>Same as fold, but encodes to ‘ascii’.</p>
</dd>
</dl>
</section>
<section id="new-algorithm">
<h2>New Algorithm<a class="headerlink" href="#new-algorithm" title="Link to this heading">#</a></h2>
<dl>
<dt>header_source_parse</dt><dd><p>Same as legacy behavior.</p>
</dd>
<dt>header_store_parse</dt><dd><p>Same as legacy behavior.</p>
</dd>
<dt>header_fetch_parse</dt><dd><p>If the value is already a header object, returns it.  Otherwise, parses the
value using the new parser, and returns the resulting object as the value.
<cite>surrogateescaped</cite> bytes get turned into unicode unknown character code
points.</p>
</dd>
<dt>fold</dt><dd><p>Uses the new header folding algorithm, respecting the policy settings.
surrogateescaped bytes are encoded using the <code class="docutils literal notranslate"><span class="pre">unknown-8bit</span></code> charset for
<code class="docutils literal notranslate"><span class="pre">cte_type=7bit</span></code> or <code class="docutils literal notranslate"><span class="pre">8bit</span></code>.  Returns a string.</p>
<p>At some point there will also be a <code class="docutils literal notranslate"><span class="pre">cte_type=unicode</span></code>, and for that
policy fold will serialize the idealized unicode message with RFC-like
folding, converting any surrogateescaped bytes into the unicode
unknown character glyph.</p>
</dd>
<dt>binary_fold</dt><dd><p>Uses the new header folding algorithm, respecting the policy settings.
surrogateescaped bytes are encoded using the <cite>unknown-8bit</cite> charset for
<code class="docutils literal notranslate"><span class="pre">cte_type=7bit</span></code>, and get turned back into bytes for <code class="docutils literal notranslate"><span class="pre">cte_type=8bit</span></code>.
Returns bytes.</p>
<p>At some point there will also be a <code class="docutils literal notranslate"><span class="pre">cte_type=unicode</span></code>, and for that
policy binary_fold will serialize the message according to :rfc:<code class="docutils literal notranslate"><span class="pre">5335</span></code>.</p>
</dd>
</dl>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./.pixi/envs/default/lib/python3.11/email"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model">The Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#message-lifecycle">Message Lifecycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#header-policy-control-during-lifecycle">Header Policy Control During Lifecycle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-binary-data">Handling Binary Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-compatibility">Backward Compatibility</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-algorithm">New Algorithm</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By DestinE Data Lake Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>